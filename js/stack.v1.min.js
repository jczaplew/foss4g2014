function stack(){function e(e,t){var n=g[0][t],i=e.sourceEvent=d3.event;try{d3.event=e,y[e.type].call(n,n.__data__,t)}finally{d3.event=i}}function t(){var e=20;a=r[1]/r[0]*innerWidth,l=innerHeight,g.style("height",a+"px").style("box-shadow","0 4px 4px rgba(0,0,0,.3)").filter(function(e,t){return m-1>t}).style("margin-bottom",e+"px"),x.style("font-size",innerWidth/r[0]*d+"px")}function n(){if(a)var e=v;a=r[1]/r[0]*innerWidth,l=innerHeight,w.style("top",(l-a)/2+"px").style("height",a+"px"),z.style("top",function(e){return(e+(1-b)/2)*l+"px"}).style("height",l*b+"px"),x.style("font-size",innerWidth/r[0]*d+"px").style("height",l*m+"px"),isNaN(e)||scrollTo(0,(v=e)*l)}function i(){var t=pageYOffset/l,n=Math.max(0,Math.min(m-1,Math.floor(t)));h!==n&&(n===h+1?(M.style("display","none"),M=N,N=d3.select(g[0][n+1]),e({type:"deactivate"},h),m-1>n&&e({type:"activate"},n+1)):n===h-1?(N.style("display","none"),N=M,M=d3.select(g[0][n]),m-1>h&&e({type:"deactivate"},h+1),e({type:"activate"},n)):(M.style("display","none"),N.style("display","none"),M=d3.select(g[0][n]),N=d3.select(g[0][n+1]),isNaN(h)||(e({type:"deactivate"},h+1),e({type:"deactivate"},h)),e({type:"activate"},n),m-1>n&&e({type:"activate"},n+1)),M.style("display","block").style("opacity",1),N.style("display","block"),h=n),t-n>.5-b?N.style("display","block").style("opacity",(t-n-.5+b)/b>=.5?1:0):N.style("display","none"),e({type:"scroll",offset:v=t},h)}function s(){var e;switch(d3.event.keyCode){case 39:if(d3.event.metaKey)return;case 40:case 34:e=d3.event.metaKey?1/0:1;break;case 37:if(d3.event.metaKey)return;case 38:case 33:e=d3.event.metaKey?-1/0:-1;break;case 32:e=d3.event.shiftKey?-1:1;break;default:return}var t=isNaN(o)?v:o;o=Math.max(0,Math.min(m-1,(e>0?Math.floor(t+(1-b)/2):Math.ceil(t-(1-b)/2))+e)),d3.select(document.documentElement).interrupt().transition().duration(500).tween("scroll",function(){var e=d3.interpolateNumber(pageYOffset,o*l);return function(t){scrollTo(0,e(t))}}).each("end",function(){o=0/0}),d3.event.preventDefault()}var a,l,o,c={},r=[1280,720],d=32,y=d3.dispatch("scroll","activate","deactivate"),p=["","-webkit-","-moz-","-ms-","-o-"].reduce(function(e,t){return null==e&&t+"transition"in document.body.style?t:e},null),u="ontouchstart"in document,f=u?t:n,h=0/0,v=0,b=1/6,g=d3.selectAll("section").style("box-sizing","border-box").style("line-height","1.35em"),m=g.size(),x=d3.select("body").style("margin",0).style("padding",0).style("background","#333");if(u)g.style("position","relative"),d3.select(window).on("resize.stack",f).each(f);else{var k=d3.select("body").insert("div","section").style("background","#000").style("box-shadow","0 8px 16px rgba(0,0,0,.3)");g.style(p+"transition","opacity 250ms linear").style("display","none");var w=d3.selectAll(g[0].concat(k.node())).style("position","fixed").style("left",0).style("top",0).style("width","100%"),z=d3.select("body").append("div").attr("class","indicator").selectAll("div").data(d3.range(g.size())).enter().append("div").style("position","absolute").style("left",0).style("width","3px").style("background","linear-gradient(to top,black,white)"),M=d3.select(g[0][0]).style("display","block"),N=d3.select(g[0][1]).style("display","block");d3.select(window).on("resize.stack",f).on("scroll.stack",i).on("keydown.stack",s).each(f),d3.timer(function(){return i(),!0})}return c.size=function(e){return arguments.length?(r=[+e[0],+e[1]],f(),c):r},c.scrollRatio=function(e){return arguments.length?(b=+e,f(),c):b},c.fontSize=function(e){return arguments.length?(d=+e,f(),c):d},d3.rebind(c,y,"on"),c}